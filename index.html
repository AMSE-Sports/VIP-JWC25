<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>VIP Registration • WGP#1</title>

  <!-- Supabase JS Client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.48.0/dist/umd/supabase.js"></script>

  <style>
    :root {
      --primary:#f37021;
      --border:#e5e7eb;
      --ok:#16a34a;
      --font-base:clamp(18px, 2vw, 20px);
      --font-label:clamp(17px, 1.9vw, 19px);
      --font-title:clamp(24px, 3vw, 30px);
      --font-note:clamp(14px, 1.6vw, 16px);
    }

    * { box-sizing:border-box; }

    body {
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      background:#f9fafb;
      color:#111827;
      font-size:var(--font-base);
    }

    .header {
      background:#000;
    }
    .header img {
      display:block;
      width:100%;
      height:auto;
    }

    .container {
      max-width:980px;
      margin:0 auto;
      padding:24px 16px 40px;
    }

    .card {
      background:#fff;
      border-radius:18px;
      box-shadow:0 10px 40px rgba(15,23,42,0.08);
      border:1px solid #e5e7eb;
      overflow:hidden;
    }

    .head {
      padding:20px 20px 12px;
      border-bottom:1px solid var(--border);
    }

    .head h1 {
      margin:0 0 4px;
      font-size:var(--font-title);
      font-weight:900;
    }

    .head p {
      margin:0;
      font-size:var(--font-note);
      color:#4b5563;
    }

    .body {
      padding:20px;
    }

    .row {
      display:grid;
      grid-template-columns:1fr;
      gap:16px;
      margin-bottom:16px;
    }

    @media (min-width:760px) {
      .row.two {
        grid-template-columns:1fr 1fr;
      }
    }

    label.title {
      font-weight:800;
      font-size:var(--font-label);
      margin-bottom:6px;
      display:block;
    }

    .en-label {
      font-weight:600;
      color:#6b7280;
      font-size:calc(var(--font-label) - 1px);
      margin-left:4px;
    }

    input, select {
      width:100%;
      padding:14px 16px;
      border-radius:14px;
      border:1px solid var(--border);
      background:#fff;
      font-family:inherit;
      font-size:var(--font-base);
      outline:none;
      transition:border-color .15s, box-shadow .15s, background .15s;
    }

    input:focus, select:focus {
      border-color:var(--primary);
      box-shadow:0 0 0 3px rgba(243,112,33,.18);
    }

    .note {
      font-size:var(--font-note);
      color:#6b7280;
    }

    .btn {
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:14px 20px;
      border-radius:14px;
      border:none;
      cursor:pointer;
      font-weight:800;
      font-size:var(--font-base);
    }

    .btn-primary {
      width:100%;
      background:var(--primary);
      color:#fff;
      box-shadow:0 12px 30px -16px rgba(248,113,22,0.9);
    }

    .btn-primary:disabled {
      opacity:.6;
      cursor:default;
      box-shadow:none;
    }

    .btn-secondary {
      background:#fff;
      color:#111827;
      border:1px solid #d1d5db;
      box-shadow:0 4px 14px rgba(15,23,42,0.06);
      gap:8px;
    }

    .footer {
      margin-top:12px;
      text-align:center;
      font-size:var(--font-note);
      color:#9ca3af;
    }

    /* Consent */
    .consent-box {
      padding:14px 14px 10px;
      border-radius:14px;
      background:#f9fafb;
      border:1px solid #e5e7eb;
      margin-top:4px;
    }

    .consent-check {
      display:flex;
      align-items:flex-start;
      gap:10px;
      margin-top:10px;
      font-size:var(--font-base);
    }

    .consent-check input[type="checkbox"] {
      flex:0 0 auto;
      width:1.25em;
      height:1.25em;
      margin-top:0.25em;
      accent-color:var(--primary);
    }

    .hidden { display:none!important; }

    .success {
      margin-top:18px;
      padding:14px 16px;
      border-radius:12px;
      background:#ecfdf3;
      border:1px solid #bbf7d0;
      color:#166534;
      font-size:var(--font-note);
    }

    .error {
      margin-top:18px;
      padding:14px 16px;
      border-radius:12px;
      background:#fef2f2;
      border:1px solid #fecaca;
      color:#b91c1c;
      font-size:var(--font-note);
    }

    /* ทำให้ select/option ใหญ่ขึ้นบน iPad / tablet */
    @media (min-width:768px) and (pointer:coarse) {
      select, select option {
        font-size:22px;
        line-height:1.6;
      }
    }

    .section-title {
      font-weight:800;
      font-size:var(--font-label);
      margin:6px 0 4px;
      padding:6px 10px;
      border-radius:10px;
      background:#fff7f1;
      border:1px solid #fed7aa;
      color:#b45309;
    }

    .follower-block {
      padding:12px 14px;
      border-radius:12px;
      border:1px solid #e5e7eb;
      background:#f9fafb;
      margin-bottom:10px;
    }

    .follower-title {
      font-weight:700;
      font-size:var(--font-note);
      margin-bottom:8px;
      color:#374151;
    }
  </style>
</head>
<body>
  <!-- HEADER IMAGE -->
  <div class="header">
    <img src="Header.png" alt="WGP#1 Waterjet World Cup 2025 Header">
  </div>

  <main class="container">
    <div class="card">
      <div class="head">
        <h1>VIP Registration</h1>
        <p>ลงทะเบียนแขก VIP และผู้ติดตาม สำหรับเข้าร่วมงาน WGP#1 Waterjet World Cup 2025</p>
      </div>

      <form class="body" id="vip-form">
        <!-- A. VIP MAIN GUEST -->
        <div class="section-title">A. ข้อมูลแขก VIP</div>

        <div class="row two">
          <div>
            <label class="title">ชื่อจริง<span class="en-label"> / First Name</span> *</label>
            <input id="vip_first_name" required>
          </div>
          <div>
            <label class="title">นามสกุล<span class="en-label"> / Last Name</span> *</label>
            <input id="vip_last_name" required>
          </div>
        </div>

        <div class="row two">
          <div>
            <label class="title">ตำแหน่ง<span class="en-label"> / Position</span> *</label>
            <input id="vip_position" required placeholder="เช่น CEO, Director, President">
          </div>
          <div>
            <label class="title">หน่วยงาน / องค์กร<span class="en-label"> / Organization</span> *</label>
            <input id="vip_organization" required placeholder="เช่น Sports Authority of Thailand">
          </div>
        </div>

        <div class="row">
          <div>
            <label class="title">เบอร์ติดต่อ (Mobile / WhatsApp) *</label>
            <input id="vip_phone" type="tel" required placeholder="+66 ... / +...">
          </div>
        </div>

        <!-- B. FOLLOWERS -->
        <div class="section-title">B. ผู้ติดตาม (ถ้ามี)</div>

        <div id="followers-wrapper">
          <!-- ผู้ติดตามคนที่ 1 (เริ่มต้น) -->
          <div class="follower-block">
            <div class="follower-title">ผู้ติดตามคนที่ 1 / Accompanying Guest 1</div>
            <div class="row two">
              <div>
                <label class="title">ชื่อ–นามสกุล<span class="en-label"> / Full Name</span></label>
                <input class="follower-name">
              </div>
              <div>
                <label class="title">ตำแหน่ง / ความสัมพันธ์<span class="en-label"> / Role / Relation</span></label>
                <input class="follower-position" placeholder="เช่น Assistant, Staff, Spouse">
              </div>
            </div>
            <div class="row">
              <div>
                <label class="title">เบอร์ติดต่อผู้ติดตาม<span class="en-label"> / Contact Phone</span></label>
                <input class="follower-phone" type="tel" placeholder="+66 ... / +...">
              </div>
            </div>
          </div>
        </div>

        <button type="button" class="btn btn-secondary" id="add-follower-btn" style="margin-bottom:10px;">
          + เพิ่มผู้ติดตาม • Add Accompanying Guest
        </button>

        <!-- C. CONSENT -->
        <div class="section-title">C. Consent</div>

        <div class="row">
          <div>
            <label class="title">การจัดเก็บข้อมูล และการใช้ภาพ/วิดีโอ</label>
            <div class="consent-box">
              <p class="note">
                TH: ข้าพเจ้าขอรับรองว่าข้อมูลที่ให้ไว้ในแบบฟอร์มนี้เป็นความจริง และยินยอมให้ผู้จัดงาน
                WGP#1 Waterjet World Cup 2025 จัดเก็บและใช้ข้อมูลของข้าพเจ้าและผู้ติดตาม
                เพื่อการบริหารจัดการงาน การจัดลำดับที่นั่ง พิธีการ การรักษาความปลอดภัย
                และการติดต่อประสานงานที่เกี่ยวข้องกับการแข่งขันเท่านั้น
                ข้อมูลจะไม่ถูกนำไปใช้ในวัตถุประสงค์อื่นโดยไม่ได้รับความยินยอมเพิ่มเติม
              </p>
              <p class="note">
                นอกจากนี้ การเข้าร่วมงานซึ่งมีการถ่ายทอดสดและเผยแพร่สู่สาธารณะทั่วโลก
                ถือเป็นการยินยอมให้ผู้จัดงานและพันธมิตร สามารถบันทึกภาพนิ่ง วิดีโอ และเสียงของท่าน
                เพื่อนำไปใช้ในสื่อประชาสัมพันธ์ โฆษณา ถ่ายทอดสด คลิปไฮไลต์ และสื่ออื่น ๆ ที่เกี่ยวข้อง
                โดยไม่ต้องขออนุญาตเป็นรายครั้ง หรือจ่ายค่าตอบแทนเพิ่มเติม
              </p>
              <p class="note">
                EN: I confirm that the information provided in this form is accurate and complete, and I consent to the
                organizers of the WGP#1 Waterjet World Cup 2025 collecting and using my personal data and that of my
                accompanying guests solely for event management, seating and protocol arrangements, security,
                and official communications related to the event. The data will not be used for other purposes
                without further consent.
              </p>
              <p class="note">
                By attending the event, I also grant the organizers and their partners the right to photograph, film,
                and record my image and voice (and those of my accompanying guests) for broadcasting, promotions,
                advertising, live streaming, highlight clips, and other related media, without the need for
                additional permission or compensation.
              </p>

              <label class="consent-check">
                <input type="checkbox" id="consent" required>
                <span>
                  ฉันได้อ่านและยินยอมตามเงื่อนไขการใช้ข้อมูลและการบันทึกภาพ/วิดีโอข้างต้น<br>
                  I have read and consent to the personal data and media conditions above.
                </span>
              </label>
            </div>
          </div>
        </div>

        <button type="submit" class="btn btn-primary" id="submit-btn">
          ส่งข้อมูลลงทะเบียน • Submit VIP Registration
        </button>

        <div id="message" class="hidden"></div>
      </form>
    </div>

    <div class="footer">
      © 2025 WGP#1 Waterjet World Cup
    </div>
  </main>

  <script>
    // ---------- Supabase Config ----------
    const SUPABASE_URL = 'https://mhecpnqwwxspxfhdvzsc.supabase.co';
    const SUPABASE_ANON_KEY =
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1oZWNwbnF3d3hzcHhmaGR2enNjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwMDc0MjEsImV4cCI6MjA3ODU4MzQyMX0.ONaEMqU6BHuMSywE3Yvtbj78NqBbecI18amsD18Cgnc';

    const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    async function submitToSupabase(payload) {
      const { error } = await sb
        // เปลี่ยนชื่อตารางให้ตรงกับที่คุณสร้างใน Supabase
        .from('vip_ticket_registrations')
        .insert({
          vip_fullname: payload.vip_fullname,
          vip_position: payload.vip_position,
          vip_organization: payload.vip_organization,
          vip_phone: payload.vip_phone,
          followers: payload.followers,  // แนะนำให้คอลัมน์เป็นชนิด jsonb
          consent: !!payload.consent
        });

      if (error) {
        console.error('[Supabase insert error]', error);
        throw error;
      }
    }

    // ---------- Dynamic followers ----------
    const followersWrapper = document.getElementById('followers-wrapper');
    const addFollowerBtn = document.getElementById('add-follower-btn');
    let followerCount = 1;

    addFollowerBtn.addEventListener('click', () => {
      followerCount += 1;
      const block = document.createElement('div');
      block.className = 'follower-block';
      block.innerHTML = `
        <div class="follower-title">ผู้ติดตามคนที่ ${followerCount} / Accompanying Guest ${followerCount}</div>
        <div class="row two">
          <div>
            <label class="title">ชื่อ–นามสกุล<span class="en-label"> / Full Name</span></label>
            <input class="follower-name">
          </div>
          <div>
            <label class="title">ตำแหน่ง / ความสัมพันธ์<span class="en-label"> / Role / Relation</span></label>
            <input class="follower-position" placeholder="เช่น Assistant, Staff, Spouse">
          </div>
        </div>
        <div class="row">
          <div>
            <label class="title">เบอร์ติดต่อผู้ติดตาม<span class="en-label"> / Contact Phone</span></label>
            <input class="follower-phone" type="tel" placeholder="+66 ... / +...">
          </div>
        </div>
      `;
      followersWrapper.appendChild(block);
    });

    // ---------- Form Submit ----------
    const form = document.getElementById('vip-form');
    const submitBtn = document.getElementById('submit-btn');
    const messageBox = document.getElementById('message');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      messageBox.className = 'hidden';
      messageBox.textContent = '';

      const vipFirst = document.getElementById('vip_first_name').value.trim();
      const vipLast = document.getElementById('vip_last_name').value.trim();

      const followers = [];
      document.querySelectorAll('.follower-block').forEach(block => {
        const name = (block.querySelector('.follower-name')?.value || '').trim();
        const position = (block.querySelector('.follower-position')?.value || '').trim();
        const phone = (block.querySelector('.follower-phone')?.value || '').trim();
        // บันทึกเฉพาะถ้ามีกรอกอย่างน้อย 1 ช่อง
        if (name || position || phone) {
          followers.push({ name, position, phone });
        }
      });

      const payload = {
        vip_fullname: vipFirst + ' ' + vipLast,
        vip_position: document.getElementById('vip_position').value.trim(),
        vip_organization: document.getElementById('vip_organization').value.trim(),
        vip_phone: document.getElementById('vip_phone').value.trim(),
        followers: followers, // จะถูกส่งเป็น JSON ไปยังคอลัมน์ jsonb
        consent: document.getElementById('consent').checked
      };

      submitBtn.disabled = true;
      submitBtn.textContent = 'กำลังบันทึก... / Submitting...';

      try {
        await submitToSupabase(payload);

        messageBox.className = 'success';
        messageBox.textContent =
          'บันทึกข้อมูล VIP เรียบร้อยแล้ว ขอบคุณที่ลงทะเบียนเข้าร่วมงาน.';
        form.reset();
        messageBox.scrollIntoView({ behavior:'smooth', block:'center' });
      } catch (err) {
        messageBox.className = 'error';
        messageBox.textContent =
          'เกิดข้อผิดพลาดในการบันทึกข้อมูล กรุณาลองอีกครั้ง หรือแจ้งเจ้าหน้าที่.';
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'ส่งข้อมูลลงทะเบียน • Submit VIP Registration';
      }
    });
  </script>
</body>
</html>
